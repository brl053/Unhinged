<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè† Unhinged Control Center - Table of Contents</title>
    <link rel="stylesheet" href="shared/styles.css">
    <script src="shared/config.js"></script>
    <script src="shared/registry.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }
        
        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .navigation {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .nav-link {
            background: rgba(255,255,255,0.9);
            color: #1f2937;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
            font-weight: 600;
        }

        .nav-link:hover {
            background: rgba(255,255,255,1);
            transform: translateY(-2px);
            color: #111827;
        }

        .nav-link.active {
            background: #10b981;
            border-color: #10b981;
            color: white;
        }
        
        .service-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }
        
        .service-card:hover {
            transform: translateY(-5px);
        }
        
        .service-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .service-icon {
            font-size: 2.5rem;
            margin-right: 15px;
        }
        
        .service-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
        }
        
        .service-controls {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .service-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }
        
        .service-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        
        .service-btn.danger {
            background: #ef4444;
        }
        
        .service-btn.danger:hover {
            background: #dc2626;
        }
        
        .kawaii-toc {
            background: #1a1a1a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 2rem;
            border-radius: 8px;
            margin: 1rem 0;
            white-space: pre-wrap;
            font-size: 0.9rem;
            overflow-x: auto;
        }
        
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }
        
        .file-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        
        .file-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }
        
        .file-card.control {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .file-card.ai-services {
            border-color: #8b5cf6;
            background: rgba(139, 92, 246, 0.1);
        }
        
        .file-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .file-description {
            color: #666;
            margin-bottom: 1rem;
        }
        
        .file-link {
            background: #3b82f6;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .file-link:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <div class="navigation">
            <a href="index.html" class="nav-link active">üè† Home</a>
            <a href="dag-control.html" class="nav-link">üéõÔ∏è DAG Control</a>
            <a href="service-orchestration.html" class="nav-link">üéõÔ∏è Service Orchestration</a>
            <a href="text-test.html" class="nav-link">üöÄ Text Generation</a>
            <a href="image-test.html" class="nav-link">üëÅÔ∏è Vision AI</a>
            <a href="voice-test.html" class="nav-link">üé§ Voice Processing</a>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>üè† Unhinged Control Center</h1>
            <p>Table of Contents - All Platform Capabilities</p>
        </div>

        <!-- Service Controls -->
        <div class="service-card">
            <div class="service-header">
                <div class="service-icon">üöÄ</div>
                <div class="service-title">Service Management</div>
            </div>
            <div class="service-content">
                <div class="service-controls">
                    <button class="service-btn" onclick="startAllServices()">
                        üöÄ Start All Services
                    </button>
                    <button class="service-btn danger" onclick="stopAllServices()">
                        üõë Stop All Services
                    </button>
                    <button class="service-btn" onclick="restartAllServices()">
                        üîÑ Restart Services
                    </button>
                    <button class="service-btn" onclick="checkServiceStatus()">
                        üìä Check Status
                    </button>
                </div>
                <div id="service-status" style="margin-top: 1rem;"></div>
            </div>
        </div>

        <!-- Kawaii ASCII TOC -->
        <div class="service-card">
            <div class="service-header">
                <div class="service-icon">üìã</div>
                <div class="service-title">File Registry</div>
            </div>
            <div class="service-content">
                <div id="kawaii-toc" class="kawaii-toc">
                    Loading file registry...
                </div>
            </div>
        </div>

        <!-- File Grid -->
        <div id="file-grid" class="file-grid">
            <!-- Populated by JavaScript -->
        </div>
    </div>

    <script>
        // Service Management Functions
        async function startAllServices() {
            showNotification('üöÄ Starting all services...', 'info');
            try {
                const response = await fetch('http://localhost:9000/dag/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({target: 'start-all-services'})
                });

                if (response.ok) {
                    showNotification('‚úÖ Services starting...', 'success');
                    monitorServiceStartup();
                } else {
                    showNotification('‚ùå Failed to start services', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function stopAllServices() {
            const confirmed = confirm('Are you sure you want to stop all services?');
            if (confirmed) {
                showNotification('üõë Stopping all services...', 'info');
                try {
                    const response = await fetch('http://localhost:9000/dag/execute', {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({target: 'stop-all-services'})
                    });

                    if (response.ok) {
                        showNotification('‚úÖ Services stopped', 'success');
                    } else {
                        showNotification('‚ùå Failed to stop services', 'error');
                    }
                } catch (error) {
                    showNotification('‚ùå Error: ' + error.message, 'error');
                }
            }
        }

        async function restartAllServices() {
            showNotification('üîÑ Restarting all services...', 'info');
            try {
                const response = await fetch('http://localhost:9000/dag/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({target: 'restart-services'})
                });

                if (response.ok) {
                    showNotification('‚úÖ Services restarting...', 'success');
                    monitorServiceStartup();
                } else {
                    showNotification('‚ùå Failed to restart services', 'error');
                }
            } catch (error) {
                showNotification('‚ùå Error: ' + error.message, 'error');
            }
        }

        async function checkServiceStatus() {
            showNotification('üìä Checking service status...', 'info');

            // First check if Docker is running
            try {
                const dockerCheck = await fetch('http://localhost:9000/dag/execute', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({target: 'check-docker-status'})
                });
            } catch (error) {
                console.log('Docker status check failed:', error);
            }

            const services = [
                {name: 'Database', url: 'http://localhost:5432', type: 'tcp'},
                {name: 'Backend', url: 'http://localhost:8080/health'},
                {name: 'Frontend', url: 'http://localhost:3000'},
                {name: 'Ollama', url: 'http://localhost:11434/api/tags'},
                {name: 'Whisper TTS', url: 'http://localhost:8000/health'},
                {name: 'Vision AI', url: 'http://localhost:8001/health'}
            ];

            let statusHtml = '<h4>Service Status:</h4>';
            let anyStarting = false;

            for (const service of services) {
                try {
                    const isReady = await checkServiceHealth(service.url);
                    if (isReady) {
                        statusHtml += `<div>‚úÖ ${service.name} - Ready</div>`;
                    } else {
                        statusHtml += `<div>‚è≥ ${service.name} - Starting...</div>`;
                        anyStarting = true;
                    }
                } catch (error) {
                    statusHtml += `<div>‚ùå ${service.name} - Not available</div>`;
                }
            }

            if (anyStarting) {
                statusHtml += '<div style="margin-top: 1rem; color: #666; font-style: italic;">Services are starting up. This can take 1-2 minutes...</div>';
            }

            document.getElementById('service-status').innerHTML = statusHtml;
        }

        async function checkServiceHealth(url) {
            try {
                const response = await fetch(url, {timeout: 5000});
                return response.ok;
            } catch (error) {
                return false;
            }
        }

        function monitorServiceStartup() {
            const interval = setInterval(async () => {
                await checkServiceStatus();
            }, 3000);

            // Stop monitoring after 2 minutes
            setTimeout(() => clearInterval(interval), 120000);
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 1rem 2rem;
                border-radius: 8px;
                color: white;
                font-weight: bold;
                z-index: 1000;
                background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => notification.remove(), 5000);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load registry and generate TOC
            if (window.UNHINGED_REGISTRY) {
                generateFileGrid();
                generateKawaiiTOC();
            } else {
                document.getElementById('kawaii-toc').textContent = 'Registry not loaded';
            }
        });

        function generateFileGrid() {
            const grid = document.getElementById('file-grid');
            const files = Object.entries(window.UNHINGED_REGISTRY || {});

            grid.innerHTML = files.map(([path, meta]) => `
                <div class="file-card ${meta.category}">
                    <div class="file-title">${meta.title}</div>
                    <div class="file-description">${meta.description || 'No description available'}</div>
                    <a href="${path.replace('/control/static_html/', '')}" class="file-link">
                        Open ${meta.category === 'control' ? 'üéõÔ∏è' : meta.category === 'ai-services' ? 'ü§ñ' : 'üìÑ'}
                    </a>
                </div>
            `).join('');
        }

        function generateKawaiiTOC() {
            if (window.generateKawaiiTOC) {
                document.getElementById('kawaii-toc').textContent = window.generateKawaiiTOC();
            } else {
                document.getElementById('kawaii-toc').textContent = 'TOC generator not available';
            }
        }
    </script>
</body>
</html>
