<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéõÔ∏è Service Orchestration - Unhinged Control</title>
    <link rel="stylesheet" href="shared/theme.css">
    <script src="shared/config.js"></script>
    <script src="shared/service-orchestration.js"></script>
    <style>
        /* Service Orchestration specific styles */
        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-2xl);
            background: var(--color-background);
            padding: var(--spacing-xl);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow);
        }

        .page-header h1 {
            background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Service Tiers */
        .tier {
            background: var(--color-background);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .tier:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-lg);
        }

        .tier-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-lg);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }

        .tier-description {
            color: var(--color-text-secondary);
            font-size: var(--font-size-sm);
            margin: 0;
        }

        .tier-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        .tier-status {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .tier-toggle {
            min-width: 100px;
        }

        .tier-toggle.stop {
            background: var(--color-danger);
        }

        .tier-toggle.stop:hover {
            background: var(--color-danger);
        }

        /* Services Grid */
        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-md);
        }

        .service-card {
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--border-radius);
            padding: var(--spacing-md);
            transition: var(--transition);
        }

        .service-card:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .service-header h4 {
            margin: 0;
            font-size: var(--font-size-lg);
            color: var(--color-text-primary);
        }

        .service-description {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin: 0 0 var(--spacing-md) 0;
            line-height: 1.4;
        }

        .service-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
        }

        .service-port {
            font-family: 'Courier New', monospace;
            background: var(--color-background);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--border-radius);
            font-weight: 600;
        }

        .service-container {
            font-family: 'Courier New', monospace;
            opacity: 0.7;
        }

        /* Status Indicators - extend theme */
        .status-indicator.status-partial {
            background: var(--color-warning);
            box-shadow: 0 0 8px rgba(245, 158, 11, 0.4);
        }

        .status-indicator.status-healthy {
            background: var(--color-success);
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.4);
        }

        .status-indicator.status-unknown {
            background: var(--color-text-secondary);
            border: 2px dashed #9ca3af;
        }

        /* Resource Monitor */
        .resource-monitor {
            background: var(--color-background);
            border: 2px solid var(--color-border);
            border-radius: var(--border-radius-lg);
            padding: var(--spacing-xl);
            margin-top: var(--spacing-xl);
            box-shadow: var(--shadow);
        }

        .resource-bars {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }

        .resource-bar {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .resource-label {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .resource-progress {
            height: 8px;
            background: var(--color-border);
            border-radius: var(--border-radius);
            overflow: hidden;
        }

        .resource-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-success), var(--color-primary));
            transition: width 0.3s ease;
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: var(--spacing-lg);
            right: var(--spacing-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            border-radius: var(--border-radius);
            color: white;
            font-weight: 600;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .notification-info { background: var(--color-primary); }
        .notification-success { background: var(--color-success); }
        .notification-error { background: var(--color-danger); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Navigation -->
        <nav class="navigation">
            <a href="index.html" class="nav-link">üè† Home</a>
            <a href="dag-control.html" class="nav-link">üéõÔ∏è DAG Control</a>
            <a href="service-orchestration.html" class="nav-link active">üéõÔ∏è Service Orchestration</a>
            <a href="text-test.html" class="nav-link">üöÄ Text Generation</a>
            <a href="image-test.html" class="nav-link">üëÅÔ∏è Vision AI</a>
            <a href="voice-test.html" class="nav-link">üé§ Voice Processing</a>
        </nav>

        <!-- Header -->
        <div class="page-header">
            <h1>üéõÔ∏è Service Orchestration</h1>
            <p>Manage service composition and resource allocation with scientific precision</p>

            <!-- Quick Actions -->
            <div class="flex flex--gap-md flex--wrap flex--center mt-lg">
                <button class="button button--secondary" onclick="location.href='dag-control.html'">
                    üéõÔ∏è DAG Control
                </button>
                <button class="button button--danger" onclick="confirmStopAll()">
                    üõë Stop All Services
                </button>
            </div>
        </div>

        <!-- Service Tiers -->
        <div id="service-tiers">
            <!-- Dynamically populated by JavaScript -->
        </div>

        <!-- Resource Monitor -->
        <div class="resource-monitor">
            <h3>üìä System Resources</h3>
            <div class="resource-bars">
                <div class="resource-bar">
                    <div class="resource-label">
                        <span>CPU Usage</span>
                        <span id="cpu-usage">--</span>
                    </div>
                    <div class="resource-progress">
                        <div class="resource-fill" id="cpu-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resource-bar">
                    <div class="resource-label">
                        <span>Memory Usage</span>
                        <span id="memory-usage">--</span>
                    </div>
                    <div class="resource-progress">
                        <div class="resource-fill" id="memory-fill" style="width: 0%"></div>
                    </div>
                </div>
                <div class="resource-bar">
                    <div class="resource-label">
                        <span>Active Services</span>
                        <span id="service-count">--</span>
                    </div>
                    <div class="resource-progress">
                        <div class="resource-fill" id="service-fill" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Quick action handlers
        function confirmStopAll() {
            if (confirm('Are you sure you want to stop all services? This will shut down the entire platform.')) {
                if (window.serviceOrchestrator) {
                    // Stop all tiers in reverse dependency order
                    Object.keys(SERVICE_TIERS).reverse().forEach(async (tierId) => {
                        try {
                            await window.serviceOrchestrator.stopTier(tierId);
                        } catch (error) {
                            console.error(`Failed to stop ${tierId}:`, error);
                        }
                    });
                }
            }
        }

        // Update resource monitoring (placeholder - would connect to real metrics)
        function updateResourceMonitoring() {
            // Placeholder values - in real implementation, these would come from Docker stats
            const cpuUsage = Math.random() * 60 + 20; // 20-80%
            const memoryUsage = Math.random() * 40 + 30; // 30-70%
            const activeServices = Object.values(window.serviceOrchestrator?.serviceStatus || {})
                .filter(s => s.status === 'running').length;
            const totalServices = Object.keys(SERVICE_DEFINITIONS).length;
            
            document.getElementById('cpu-usage').textContent = `${cpuUsage.toFixed(1)}%`;
            document.getElementById('cpu-fill').style.width = `${cpuUsage}%`;
            
            document.getElementById('memory-usage').textContent = `${memoryUsage.toFixed(1)}%`;
            document.getElementById('memory-fill').style.width = `${memoryUsage}%`;
            
            document.getElementById('service-count').textContent = `${activeServices}/${totalServices}`;
            document.getElementById('service-fill').style.width = `${(activeServices / totalServices) * 100}%`;
        }

        // Start resource monitoring
        setInterval(updateResourceMonitoring, 5000);
        setTimeout(updateResourceMonitoring, 1000); // Initial update
    </script>
</body>
</html>
