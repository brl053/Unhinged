"""
@llm-does UnhingedOS runtime artifacts management with systematic VM image organization, ISO distribution, and host-VM communication interfaces
@llm-type runtime.artifacts/unhinged-os-runtime
@llm-context UnhingedOS runtime environment management for deployable artifacts including QCOW2 VM images, bootable ISOs, and 9p virtio communication interfaces for voice-first operating system deployment and development
"""

# UnhingedOS Runtime Artifacts

This directory contains deployable artifacts generated by the UnhingedOS build system, including VM images, bootable ISOs, and host-VM communication interfaces for the voice-first operating system.

## üìÅ Directory Structure

### `images/` - VM Disk Images
**Purpose:** QCOW2 virtual machine disk images for different UnhingedOS profiles

#### Current Images
- **`unhinged-os-minimal.qcow2`** - Minimal voice-first OS (193KB compressed, 1GB virtual)
  - Target: Embedded systems, IoT devices
  - RAM: 64MB, CPU: 1 core
  - Features: Core voice interface, basic graphics

- **`unhinged-os-desktop.qcow2`** - Full desktop environment (282MB compressed, 4GB virtual)
  - Target: Primary desktop replacement
  - RAM: 256MB, CPU: 2 cores
  - Features: Complete voice-first desktop, advanced graphics

- **`unhinged-os-dev.qcow2`** - Development environment (193KB compressed, 8GB virtual)
  - Target: UnhingedOS development
  - RAM: 512MB, CPU: 4 cores
  - Features: Complete dev tools, debugging, profiling

- **`hello_world_boot.img`** - Minimal boot test image (1.5MB)
  - Target: Boot sequence testing
  - Features: Basic boot validation

#### Missing Images (Generated by Build System)
- **`unhinged-os-server.qcow2`** - Headless server variant (target: 128MB RAM)

### `isos/` - Bootable ISO Images
**Purpose:** Bootable ISO images for installation and live boot

#### Current ISOs
- **`unhinged-os-custom.iso`** - Custom UnhingedOS bootable ISO (65MB)
  - Alpine Linux base with UnhingedOS pre-configured
  - Auto-setup scripts included
  - Voice-first interface ready

- **`alpine-base-3.22.2-x86_64.iso`** - Base Alpine Linux ISO (65MB)
  - Clean Alpine Linux 3.22.2 virtual edition
  - Foundation for UnhingedOS builds
  - Minimal, security-focused base

#### Missing ISOs (Generated by Build System)
- **`unhinged-os-minimal.iso`** - Minimal profile bootable ISO
- **`unhinged-os-desktop.iso`** - Desktop profile bootable ISO
- **`unhinged-os-server.iso`** - Server profile bootable ISO
- **`unhinged-os-dev.iso`** - Development profile bootable ISO

### `shared/`
**Purpose:** Host-VM communication directory
- **`vm-to-host.txt`** - VM status messages to host
- **`host-to-vm.txt`** - Host commands to VM
- **`build-artifacts/`** - Shared build artifacts
- **`logs/`** - VM system logs
- **`config/`** - Runtime configuration files

## üéØ Image Specifications

### Minimal Image (unhinged-os-minimal.qcow2)
- **Virtual Size:** 1GB
- **Actual Size:** ~64MB compressed
- **RAM Requirement:** 64MB
- **CPU Cores:** 1
- **Boot Time:** <5 seconds
- **Use Cases:** Embedded systems, IoT, voice-only interfaces

### Desktop Image (unhinged-os-desktop.qcow2)
- **Virtual Size:** 4GB
- **Actual Size:** ~256MB compressed
- **RAM Requirement:** 256MB
- **CPU Cores:** 2
- **Boot Time:** <8 seconds
- **Use Cases:** Desktop replacement, accessibility computing

### Server Image (unhinged-os-server.qcow2)
- **Virtual Size:** 2GB
- **Actual Size:** ~128MB compressed
- **RAM Requirement:** 128MB
- **CPU Cores:** 1-2
- **Boot Time:** <6 seconds
- **Use Cases:** Voice processing backend, API servers

### Development Image (unhinged-os-dev.qcow2)
- **Virtual Size:** 8GB
- **Actual Size:** ~512MB compressed
- **RAM Requirement:** 512MB
- **CPU Cores:** 4
- **Boot Time:** <10 seconds
- **Use Cases:** OS development, debugging, research

## üöÄ Deployment

### QEMU/KVM Deployment
```bash
# Start minimal UnhingedOS
qemu-system-x86_64 \
    -m 64M \
    -smp 1 \
    -drive file=images/unhinged-os-minimal.qcow2,format=qcow2 \
    -netdev user,id=net0 \
    -device virtio-net,netdev=net0 \
    -virtfs local,path=shared,mount_tag=shared,security_model=passthrough

# Start desktop UnhingedOS
qemu-system-x86_64 \
    -m 256M \
    -smp 2 \
    -drive file=images/unhinged-os-desktop.qcow2,format=qcow2 \
    -netdev user,id=net0 \
    -device virtio-net,netdev=net0 \
    -virtfs local,path=shared,mount_tag=shared,security_model=passthrough \
    -display gtk
```

### ISO Boot
```bash
# Boot from ISO
qemu-system-x86_64 \
    -m 256M \
    -cdrom isos/unhinged-os-desktop.iso \
    -boot d
```

### Production Deployment
```bash
# Copy to production environment
scp images/unhinged-os-server.qcow2 production-host:/var/lib/libvirt/images/

# Start with libvirt
virsh start unhinged-os-server
```

## üîß Host-VM Communication

### Communication Protocol
UnhingedOS uses 9p virtio filesystem for host-VM communication through the `shared/` directory.

### VM ‚Üí Host Messages
**File:** `shared/vm-to-host.txt`
```
TIMESTAMP: STATUS_MESSAGE
2024-01-01 12:00:00: UnhingedOS boot complete
2024-01-01 12:00:01: Voice interface ready
2024-01-01 12:00:02: Graphics system initialized
```

### Host ‚Üí VM Commands
**File:** `shared/host-to-vm.txt`
```
COMMAND: PARAMETERS
shutdown: graceful
restart: voice-service
config: voice-sensitivity=high
```

### Build Artifacts Sharing
**Directory:** `shared/build-artifacts/`
- Source code updates
- Configuration changes
- Library updates
- Test results

## üìä Image Management System

### Naming Conventions
UnhingedOS follows systematic naming conventions for all runtime artifacts:

#### QCOW2 Images
```
unhinged-os-{profile}.qcow2
```
- **Profile Types:** minimal, desktop, server, dev
- **Examples:** unhinged-os-minimal.qcow2, unhinged-os-desktop.qcow2

#### ISO Images
```
unhinged-os-{profile}.iso
```
- **Profile Types:** minimal, desktop, server, dev, custom
- **Examples:** unhinged-os-desktop.iso, unhinged-os-custom.iso

#### Base Images
```
alpine-base-{version}-{arch}.iso
{purpose}_boot.img
```
- **Examples:** alpine-base-3.22.2-x86_64.iso, hello_world_boot.img

### Image Lifecycle Management

#### Build Process
```bash
# Generate images using build system
./build/unhinged-os-builder.sh --profile desktop --format both
./build/unhinged-os-builder.sh --profile minimal --format qcow2
./build/unhinged-os-builder.sh --profile server --format iso
```

#### Image Operations
```bash
# Check image information
qemu-img info images/unhinged-os-desktop.qcow2

# Verify image integrity
qemu-img check images/unhinged-os-minimal.qcow2

# Compress for distribution
qemu-img convert -c -O qcow2 source.qcow2 compressed.qcow2

# Resize development images
qemu-img resize images/unhinged-os-dev.qcow2 +2G
```

#### Testing & Validation
```bash
# Quick boot test (minimal)
qemu-system-x86_64 -m 64M -drive file=images/unhinged-os-minimal.qcow2 -nographic

# Desktop environment test
qemu-system-x86_64 -m 256M -smp 2 -drive file=images/unhinged-os-desktop.qcow2 -display gtk

# Server headless test
qemu-system-x86_64 -m 128M -drive file=images/unhinged-os-server.qcow2 -netdev user,id=net0 -device virtio-net,netdev=net0
```

### Version Management
```bash
# Create versioned backup
cp images/unhinged-os-desktop.qcow2 images/unhinged-os-desktop-v$(date +%Y%m%d).qcow2

# Symlink management for current version
ln -sf unhinged-os-desktop-v20241029.qcow2 unhinged-os-desktop.qcow2

# Archive old versions
mkdir -p archive/$(date +%Y%m)
mv images/unhinged-os-*-v$(date -d '1 month ago' +%Y%m)*.qcow2 archive/$(date -d '1 month ago' +%Y%m)/
```

### Storage Optimization
```bash
# Check actual disk usage
du -sh images/*.qcow2 isos/*.iso

# Compress all images for distribution
for img in images/*.qcow2; do
    qemu-img convert -c -O qcow2 "$img" "${img%.qcow2}-compressed.qcow2"
done

# Clean up build artifacts
rm -f images/*-build-*.qcow2 isos/*-build-*.iso
```

## üîí Security Considerations

### Image Security
- Images are read-only by default
- No network services enabled by default
- Minimal package set to reduce attack surface
- Regular security updates through rebuild process

### Communication Security
- Host-VM communication is isolated to shared directory
- No direct network access from VM
- File permissions strictly controlled
- Audit logging of all communication

---

**UnhingedOS Runtime: Deployable artifacts for voice-first computing**
