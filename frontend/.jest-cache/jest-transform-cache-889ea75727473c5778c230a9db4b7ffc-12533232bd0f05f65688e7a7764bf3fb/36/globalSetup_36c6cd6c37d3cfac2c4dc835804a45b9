4568b89da3cb0b61329921f34c6762a5
"use strict";
/**
 * @fileoverview Jest Global Setup
 *
 * @description
 * Global setup for Jest test suite. Runs once before all tests.
 * Sets up test environment, starts mock servers, and initializes
 * test databases.
 *
 * @author LLM Agent
 * @version 1.0.0
 * @since 2025-01-04
 */
var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {
    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.default = globalSetup;
const promises_1 = __importDefault(require("fs/promises"));
function globalSetup() {
    return __awaiter(this, void 0, void 0, function* () {
        console.log('üöÄ Setting up Jest test environment...');
        try {
            // Create test directories
            yield createTestDirectories();
            // Setup test database
            yield setupTestDatabase();
            // Verify services for integration tests
            yield verifyTestServices();
            // Setup test fixtures
            yield setupTestFixtures();
            console.log('‚úÖ Jest global setup completed successfully');
        }
        catch (error) {
            console.error('‚ùå Jest global setup failed:', error);
            throw error;
        }
    });
}
/**
 * Create necessary test directories
 */
function createTestDirectories() {
    return __awaiter(this, void 0, void 0, function* () {
        const directories = [
            'tests/fixtures/audio',
            'tests/fixtures/images',
            'tests/fixtures/data',
            'test-results',
            'coverage',
            '.jest-cache',
        ];
        for (const dir of directories) {
            try {
                yield promises_1.default.mkdir(dir, { recursive: true });
            }
            catch (error) {
                // Directory might already exist, ignore error
            }
        }
    });
}
/**
 * Setup test database
 */
function setupTestDatabase() {
    return __awaiter(this, void 0, void 0, function* () {
        // For now, we'll use IndexedDB mocks
        // In the future, we might want to setup a test database
        console.log('üìä Test database setup completed (using mocks)');
    });
}
/**
 * Verify test services are available for integration tests
 */
function verifyTestServices() {
    return __awaiter(this, void 0, void 0, function* () {
        const services = [
            {
                name: 'TTS/STT Service',
                url: 'http://localhost:8000/health',
                required: false, // Optional for unit tests
            },
            {
                name: 'Backend API',
                url: 'http://localhost:8080/health',
                required: false, // Optional for unit tests
            },
        ];
        for (const service of services) {
            try {
                const response = yield fetch(service.url);
                if (response.ok) {
                    console.log(`‚úÖ ${service.name} is available for integration tests`);
                }
                else {
                    throw new Error(`Service returned ${response.status}`);
                }
            }
            catch (error) {
                if (service.required) {
                    throw new Error(`Required service ${service.name} is not available: ${error}`);
                }
                else {
                    console.log(`‚ö†Ô∏è  ${service.name} is not available (integration tests will be skipped)`);
                }
            }
        }
    });
}
/**
 * Setup test fixtures
 */
function setupTestFixtures() {
    return __awaiter(this, void 0, void 0, function* () {
        // Create sample test data
        const testData = {
            sampleMessages: [
                {
                    id: '1',
                    type: 'sent',
                    message: 'Hello, this is a test message',
                    timestamp: Date.now(),
                },
                {
                    id: '2',
                    type: 'received',
                    message: 'This is a response message',
                    timestamp: Date.now() + 1000,
                },
            ],
            sampleTranscriptions: [
                {
                    text: 'Hello world',
                    language: 'en',
                    confidence: 0.95,
                },
                {
                    text: 'Create a React component',
                    language: 'en',
                    confidence: 0.88,
                },
            ],
            sampleAudioTestCases: [
                {
                    id: 'test-basic',
                    text: 'This is a basic test',
                    description: 'Basic test case',
                },
                {
                    id: 'test-technical',
                    text: 'Create a TypeScript interface',
                    description: 'Technical terminology test',
                },
            ],
        };
        yield promises_1.default.writeFile('tests/fixtures/data/testData.json', JSON.stringify(testData, null, 2));
        console.log('üìÅ Test fixtures created');
    });
}
/**
 * Check if running in CI environment
 */
function isCI() {
    return !!(process.env.CI ||
        process.env.CONTINUOUS_INTEGRATION ||
        process.env.BUILD_NUMBER ||
        process.env.GITHUB_ACTIONS ||
        process.env.GITLAB_CI);
}
/**
 * Get test environment configuration
 */
function getTestConfig() {
    return {
        isCI: isCI(),
        timeout: isCI() ? 30000 : 10000,
        retries: isCI() ? 2 : 0,
        workers: isCI() ? 2 : '50%',
    };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2hvbWUvZS1ibGlzcy1zdGF0aW9uLTEvcHJvamVjdHMvVW5oaW5nZWQvZnJvbnRlbmQvdGVzdHMvc2V0dXAvZ2xvYmFsU2V0dXAudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7OztHQVdHOzs7Ozs7Ozs7Ozs7OztBQU1ILDhCQXFCQztBQXhCRCwyREFBNkI7QUFHN0IsU0FBOEIsV0FBVzs7UUFDdkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1FBRXRELElBQUksQ0FBQztZQUNILDBCQUEwQjtZQUMxQixNQUFNLHFCQUFxQixFQUFFLENBQUM7WUFFOUIsc0JBQXNCO1lBQ3RCLE1BQU0saUJBQWlCLEVBQUUsQ0FBQztZQUUxQix3Q0FBd0M7WUFDeEMsTUFBTSxrQkFBa0IsRUFBRSxDQUFDO1lBRTNCLHNCQUFzQjtZQUN0QixNQUFNLGlCQUFpQixFQUFFLENBQUM7WUFFMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO1FBQzVELENBQUM7UUFBQyxPQUFPLEtBQUssRUFBRSxDQUFDO1lBQ2YsT0FBTyxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNwRCxNQUFNLEtBQUssQ0FBQztRQUNkLENBQUM7SUFDSCxDQUFDO0NBQUE7QUFFRDs7R0FFRztBQUNILFNBQWUscUJBQXFCOztRQUNsQyxNQUFNLFdBQVcsR0FBRztZQUNsQixzQkFBc0I7WUFDdEIsdUJBQXVCO1lBQ3ZCLHFCQUFxQjtZQUNyQixjQUFjO1lBQ2QsVUFBVTtZQUNWLGFBQWE7U0FDZCxDQUFDO1FBRUYsS0FBSyxNQUFNLEdBQUcsSUFBSSxXQUFXLEVBQUUsQ0FBQztZQUM5QixJQUFJLENBQUM7Z0JBQ0gsTUFBTSxrQkFBRSxDQUFDLEtBQUssQ0FBQyxHQUFHLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUMzQyxDQUFDO1lBQUMsT0FBTyxLQUFLLEVBQUUsQ0FBQztnQkFDZiw4Q0FBOEM7WUFDaEQsQ0FBQztR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QUFHLENBQUMsMEJBQTBCLENBQUMsQ0FBQztJQUMxQyxDQUFDO0NBQUE7QUFFRDs7R0FFRztBQUNILFNBQVMsSUFBSTtJQUNYLE9BQU8sQ0FBQyxDQUFDLENBQ1AsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1FBQ2QsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0I7UUFDbEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZO1FBQ3hCLE9BQU8sQ0FBQyxHQUFHLENBQUMsY0FBYztRQUMxQixPQUFPLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FDdEIsQ0FBQztBQUNKLENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsYUFBYTtJQUNwQixPQUFPO1FBQ0wsSUFBSSxFQUFFLElBQUksRUFBRTtRQUNaLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxLQUFLO1FBQy9CLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3ZCLE9BQU8sRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLO0tBQzVCLENBQUM7QUFDSixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9ob21lL2UtYmxpc3Mtc3RhdGlvbi0xL3Byb2plY3RzL1VuaGluZ2VkL2Zyb250ZW5kL3Rlc3RzL3NldHVwL2dsb2JhbFNldHVwLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGVvdmVydmlldyBKZXN0IEdsb2JhbCBTZXR1cFxuICogXG4gKiBAZGVzY3JpcHRpb25cbiAqIEdsb2JhbCBzZXR1cCBmb3IgSmVzdCB0ZXN0IHN1aXRlLiBSdW5zIG9uY2UgYmVmb3JlIGFsbCB0ZXN0cy5cbiAqIFNldHMgdXAgdGVzdCBlbnZpcm9ubWVudCwgc3RhcnRzIG1vY2sgc2VydmVycywgYW5kIGluaXRpYWxpemVzXG4gKiB0ZXN0IGRhdGFiYXNlcy5cbiAqIFxuICogQGF1dGhvciBMTE0gQWdlbnRcbiAqIEB2ZXJzaW9uIDEuMC4wXG4gKiBAc2luY2UgMjAyNS0wMS0wNFxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMvcHJvbWlzZXMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGdsb2JhbFNldHVwKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zb2xlLmxvZygn8J+agCBTZXR0aW5nIHVwIEplc3QgdGVzdCBlbnZpcm9ubWVudC4uLicpO1xuXG4gIHRyeSB7XG4gICAgLy8gQ3JlYXRlIHRlc3QgZGlyZWN0b3JpZXNcbiAgICBhd2FpdCBjcmVhdGVUZXN0RGlyZWN0b3JpZXMoKTtcbiAgICBcbiAgICAvLyBTZXR1cCB0ZXN0IGRhdGFiYXNlXG4gICAgYXdhaXQgc2V0dXBUZXN0RGF0YWJhc2UoKTtcbiAgICBcbiAgICAvLyBWZXJpZnkgc2VydmljZXMgZm9yIGludGVncmF0aW9uIHRlc3RzXG4gICAgYXdhaXQgdmVyaWZ5VGVzdFNlcnZpY2VzKCk7XG4gICAgXG4gICAgLy8gU2V0dXAgdGVzdCBmaXh0dXJlc1xuICAgIGF3YWl0IHNldHVwVGVzdEZpeHR1cmVzKCk7XG4gICAgXG4gICAgY29uc29sZS5sb2coJ+KchSBKZXN0IGdsb2JhbCBzZXR1cCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIEplc3QgZ2xvYmFsIHNldHVwIGZhaWxlZDonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGUgbmVjZXNzYXJ5IHRlc3QgZGlyZWN0b3JpZXNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlVGVzdERpcmVjdG9yaWVzKCk6IFByb21pc2U8dm9pZD4ge1xuICBjb25zdCBkaXJlY3RvcmllcyA9IFtcbiAgICAndGVzdHMvZml4dHVyZXMvYXVkaW8nLFxuICAgICd0ZXN0cy9maXh0dXJlcy9pbWFnZXMnLFxuICAgICd0ZXN0cy9maXh0dXJlcy9kYXRhJyxcbiAgICAndGVzdC1yZXN1bHRzJyxcbiAgICAnY292ZXJhZ2UnLFxuICAgICcuamVzdC1jYWNoZScsXG4gIF07XG5cbiAgZm9yIChjb25zdCBkaXIgb2YgZGlyZWN0b3JpZXMpIHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgZnMubWtkaXIoZGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3QsIGlnbm9yZSBlcnJvclxuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIFNldHVwIHRlc3QgZGF0YWJhc2VcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2V0dXBUZXN0RGF0YWJhc2UoKTogUHJvbWlzZTx2b2lkPiB7XG4gIC8vIEZvciBub3csIHdlJ2xsIHVzZSBJbmRleGVkREIgbW9ja3NcbiAgLy8gSW4gdGhlIGZ1dHVyZSwgd2UgbWlnaHQgd2FudCB0byBzZXR1cCBhIHRlc3QgZGF0YWJhc2VcbiAgY29uc29sZS5sb2coJ/Cfk4ogVGVzdCBkYXRhYmFzZSBzZXR1cCBjb21wbGV0ZWQgKHVzaW5nIG1vY2tzKScpO1xufVxuXG4vKipcbiAqIFZlcmlmeSB0ZXN0IHNlcnZpY2VzIGFyZSBhdmFpbGFibGUgZm9yIGludGVncmF0aW9uIHRlc3RzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHZlcmlmeVRlc3RTZXJ2aWNlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgY29uc3Qgc2VydmljZXMgPSBbXG4gICAge1xuICAgICAgbmFtZTogJ1RUUy9TVFQgU2VydmljZScsXG4gICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjgwMDAvaGVhbHRoJyxcbiAgICAgIHJlcXVpcmVkOiBmYWxzZSwgLy8gT3B0aW9uYWwgZm9yIHVuaXQgdGVzdHNcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdCYWNrZW5kIEFQSScsXG4gICAgICB1cmw6ICdodHRwOi8vbG9jYWxob3N0OjgwODAvaGVhbHRoJyxcbiAgICAgIHJlcXVpcmVkOiBmYWxzZSwgLy8gT3B0aW9uYWwgZm9yIHVuaXQgdGVzdHNcbiAgICB9LFxuICBdO1xuXG4gIGZvciAoY29uc3Qgc2VydmljZSBvZiBzZXJ2aWNlcykge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHNlcnZpY2UudXJsKTtcbiAgICAgIGlmIChyZXNwb25zZS5vaykge1xuICAgICAgICBjb25zb2xlLmxvZyhg4pyFICR7c2VydmljZS5uYW1lfSBpcyBhdmFpbGFibGUgZm9yIGludGVncmF0aW9uIHRlc3RzYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFNlcnZpY2UgcmV0dXJuZWQgJHtyZXNwb25zZS5zdGF0dXN9YCk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGlmIChzZXJ2aWNlLnJlcXVpcmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgUmVxdWlyZWQgc2VydmljZSAke3NlcnZpY2UubmFtZX0gaXMgbm90IGF2YWlsYWJsZTogJHtlcnJvcn1gKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDimqDvuI8gICR7c2VydmljZS5uYW1lfSBpcyBub3QgYXZhaWxhYmxlIChpbnRlZ3JhdGlvbiB0ZXN0cyB3aWxsIGJlIHNraXBwZWQpYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogU2V0dXAgdGVzdCBmaXh0dXJlc1xuICovXG5hc3luYyBmdW5jdGlvbiBzZXR1cFRlc3RGaXh0dXJlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgLy8gQ3JlYXRlIHNhbXBsZSB0ZXN0IGRhdGFcbiAgY29uc3QgdGVzdERhdGEgPSB7XG4gICAgc2FtcGxlTWVzc2FnZXM6IFtcbiAgICAgIHtcbiAgICAgICAgaWQ6ICcxJyxcbiAgICAgICAgdHlwZTogJ3NlbnQnLFxuICAgICAgICBtZXNzYWdlOiAnSGVsbG8sIHRoaXMgaXMgYSB0ZXN0IG1lc3NhZ2UnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBpZDogJzInLFxuICAgICAgICB0eXBlOiAncmVjZWl2ZWQnLFxuICAgICAgICBtZXNzYWdlOiAnVGhpcyBpcyBhIHJlc3BvbnNlIG1lc3NhZ2UnLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkgKyAxMDAwLFxuICAgICAgfSxcbiAgICBdLFxuICAgIHNhbXBsZVRyYW5zY3JpcHRpb25zOiBbXG4gICAgICB7XG4gICAgICAgIHRleHQ6ICdIZWxsbyB3b3JsZCcsXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgICAgICBjb25maWRlbmNlOiAwLjk1LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdGV4dDogJ0NyZWF0ZSBhIFJlYWN0IGNvbXBvbmVudCcsXG4gICAgICAgIGxhbmd1YWdlOiAnZW4nLFxuICAgICAgICBjb25maWRlbmNlOiAwLjg4LFxuICAgICAgfSxcbiAgICBdLFxuICAgIHNhbXBsZUF1ZGlvVGVzdENhc2VzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAndGVzdC1iYXNpYycsXG4gICAgICAgIHRleHQ6ICdUaGlzIGlzIGEgYmFzaWMgdGVzdCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQmFzaWMgdGVzdCBjYXNlJyxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGlkOiAndGVzdC10ZWNobmljYWwnLFxuICAgICAgICB0ZXh0OiAnQ3JlYXRlIGEgVHlwZVNjcmlwdCBpbnRlcmZhY2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1RlY2huaWNhbCB0ZXJtaW5vbG9neSB0ZXN0JyxcbiAgICAgIH0sXG4gICAgXSxcbiAgfTtcblxuICBhd2FpdCBmcy53cml0ZUZpbGUoXG4gICAgJ3Rlc3RzL2ZpeHR1cmVzL2RhdGEvdGVzdERhdGEuanNvbicsXG4gICAgSlNPTi5zdHJpbmdpZnkodGVzdERhdGEsIG51bGwsIDIpXG4gICk7XG5cbiAgY29uc29sZS5sb2coJ/Cfk4EgVGVzdCBmaXh0dXJlcyBjcmVhdGVkJyk7XG59XG5cbi8qKlxuICogQ2hlY2sgaWYgcnVubmluZyBpbiBDSSBlbnZpcm9ubWVudFxuICovXG5mdW5jdGlvbiBpc0NJKCk6IGJvb2xlYW4ge1xuICByZXR1cm4gISEoXG4gICAgcHJvY2Vzcy5lbnYuQ0kgfHxcbiAgICBwcm9jZXNzLmVudi5DT05USU5VT1VTX0lOVEVHUkFUSU9OIHx8XG4gICAgcHJvY2Vzcy5lbnYuQlVJTERfTlVNQkVSIHx8XG4gICAgcHJvY2Vzcy5lbnYuR0lUSFVCX0FDVElPTlMgfHxcbiAgICBwcm9jZXNzLmVudi5HSVRMQUJfQ0lcbiAgKTtcbn1cblxuLyoqXG4gKiBHZXQgdGVzdCBlbnZpcm9ubWVudCBjb25maWd1cmF0aW9uXG4gKi9cbmZ1bmN0aW9uIGdldFRlc3RDb25maWcoKSB7XG4gIHJldHVybiB7XG4gICAgaXNDSTogaXNDSSgpLFxuICAgIHRpbWVvdXQ6IGlzQ0koKSA/IDMwMDAwIDogMTAwMDAsXG4gICAgcmV0cmllczogaXNDSSgpID8gMiA6IDAsXG4gICAgd29ya2VyczogaXNDSSgpID8gMiA6ICc1MCUnLFxuICB9O1xufVxuIl0sInZlcnNpb24iOjN9