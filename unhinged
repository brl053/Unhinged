#!/bin/bash
# Unhinged CLI - Bash shim to Python Click app
# Delegates to consolidated CLI in libs.cli.core via control.cli.__main__
set -e

# Resolve the actual script location (handles symlinks)
SCRIPT_PATH="$(readlink -f "${BASH_SOURCE[0]}")"
SCRIPT_DIR="$(dirname "$SCRIPT_PATH")"
cd "$SCRIPT_DIR"

# Use venv Python if available, otherwise system Python
if [ -f "build/python/venv/bin/python" ]; then
    PYTHON="build/python/venv/bin/python"
else
    PYTHON="python3"
fi

# Run setup checks on first launch (only if not already in PATH)
if [ ! -f ".setup_checked" ] && [ "$1" != "dev" ]; then
    echo "ðŸ”§ Running first-time setup checks..."
    $PYTHON build/setup_check.py check 2>/dev/null || true
    touch .setup_checked
fi

# Execute the Python CLI (delegates to libs.cli.core)
exec $PYTHON -m control.cli "$@"

