[mypy]
# Mypy configuration for Unhinged platform
# Mozilla-grade Python type checking
#
# Configuration Philosophy (from 179 error fixes):
# - Strict for new code (see [mypy-libs.python.type_guards])
# - Gradual for legacy code (current settings)
# - Pragmatic type: ignore for inherently dynamic operations
# - See docs/development/TYPE_SAFETY_GUIDE.md for patterns

python_version = 3.12
warn_return_any = True
warn_unused_configs = True

# Legacy code settings (gradual typing)
disallow_untyped_defs = False
disallow_incomplete_defs = False
check_untyped_defs = False

# Future: Enable for new code
# disallow_untyped_defs = True
# check_untyped_defs = True

# Add scription orchestration lib and libs/python to mypy path
mypy_path = scription/orchestration/lib:libs/python:libs/event-framework/python/src

# Ignore errors in generated code and vendored dependencies
exclude = (^generated/|^build/python/venv/|^venv/|^venv-production/|^build/)

# Per-file options for libcst visitor methods
[mypy-cli.analysis.libcst_analyzer]
# libcst visitor methods have specific naming requirements (visit_ClassName)
# These cannot be changed without breaking the visitor pattern
disable_error_code = name-defined

[mypy-build.find_usages]
disable_error_code = name-defined

[mypy-build.find_usages_recursive]
disable_error_code = name-defined

# Ignore missing stubs for third-party libraries
[mypy-yaml.*]
ignore_missing_imports = True

[mypy-redis.*]
ignore_missing_imports = True

[mypy-gi.*]
ignore_missing_imports = True

[mypy-gi.repository.*]
ignore_missing_imports = True

# Third-party libraries without type stubs
[mypy-googleapiclient.*]
ignore_missing_imports = True

[mypy-google_auth_oauthlib.*]
ignore_missing_imports = True

[mypy-imageio.*]
ignore_missing_imports = True

[mypy-whisper.*]
ignore_missing_imports = True

[mypy-gtts.*]
ignore_missing_imports = True

[mypy-ultralytics.*]
ignore_missing_imports = True

[mypy-mss.*]
ignore_missing_imports = True

[mypy-librosa.*]
ignore_missing_imports = True

[mypy-soundfile.*]
ignore_missing_imports = True

[mypy-pydub.*]
ignore_missing_imports = True

[mypy-ollama.*]
ignore_missing_imports = True

[mypy-anthropic.*]
ignore_missing_imports = True

[mypy-weaviate.*]
ignore_missing_imports = True

[mypy-sentence_transformers.*]
ignore_missing_imports = True

# Proto-generated clients (may not exist yet)
[mypy-unhinged_proto_clients.*]
ignore_missing_imports = True

# Modules that may not exist in all environments
[mypy-network.*]
ignore_missing_imports = True

[mypy-orchestrator.*]
ignore_missing_imports = True

[mypy-config.build_config]
ignore_missing_imports = True

[mypy-simple_vm_launcher]
ignore_missing_imports = True

[mypy-enhanced_vm_launcher]
ignore_missing_imports = True

# Build system modules (complex import paths)
[mypy-modules]
ignore_missing_imports = True

[mypy-generators.*]
ignore_missing_imports = True

[mypy-_abstract_generator]
ignore_missing_imports = True

[mypy-design_token_builder]
ignore_missing_imports = True

[mypy-document_store]
ignore_missing_imports = True

[mypy-component_generator]
ignore_missing_imports = True

[mypy-component_validator]
ignore_missing_imports = True

# ============================================================================
# STRICT MODE - INCREMENTAL ENFORCEMENT
# ============================================================================
# Directories with 0 errors as of 2025-11-21 baseline audit
# See docs/development/MYPY_BASELINE_AUDIT.md for details
#
# Strategy: Enable strict mode for clean directories, prevent regressions
# Legacy directories (graph-service, image-generation, chat-with-sessions)
# remain permissive until errors fixed

# Control directories (7 directories, 1,563 lines, 0 errors)
# Using warn_return_any + check_untyped_defs for softer enforcement
# Full strict mode (disallow_untyped_defs) causes issues with local imports
[mypy-control.network.*]
check_untyped_defs = True
warn_return_any = True

[mypy-control.cli.*]
check_untyped_defs = True
warn_return_any = True

[mypy-control.deployment.*]
check_untyped_defs = True
warn_return_any = True

[mypy-control.system.*]
check_untyped_defs = True
warn_return_any = True

# Libs directories (5 directories, 15,566 lines, 0 errors)
[mypy-libs.python.*]
check_untyped_defs = True
warn_return_any = True

[mypy-libs.event-framework.*]
check_untyped_defs = True
warn_return_any = True

[mypy-libs.graphics.*]
check_untyped_defs = True
warn_return_any = True

[mypy-libs.services.*]
check_untyped_defs = True
warn_return_any = True

[mypy-libs.design_system.*]
check_untyped_defs = True
warn_return_any = True

# Services directories (4 directories, 1,385 lines, 0 errors)
[mypy-services.shared.*]
check_untyped_defs = True
warn_return_any = True

[mypy-services.speech-to-text.*]
check_untyped_defs = True
warn_return_any = True

[mypy-services.text-to-speech.*]
check_untyped_defs = True
warn_return_any = True

[mypy-services.vision-ai.*]
check_untyped_defs = True
warn_return_any = True

# ============================================================================
# LEGACY DIRECTORIES - PERMISSIVE MODE (TEMPORARY)
# ============================================================================
# These directories have errors and remain permissive until fixed
# Target: Q1 2025 migration

# services/graph-service: MIGRATED (was 6 errors)
[mypy-services.graph-service.*]
check_untyped_defs = True
warn_return_any = True

# services/image-generation: MIGRATED (was 1 error - missing import stub)
[mypy-services.image-generation.*]
check_untyped_defs = True
warn_return_any = True

# Ignore missing import for sovereign image generation module
[mypy-modules.image_generation]
ignore_missing_imports = True

# Ignore local events.py modules in services (they define ServiceLogger locally)
[mypy-events]
ignore_missing_imports = True

# services/chat-with-sessions: MIGRATED (was 20 errors)
[mypy-services.chat-with-sessions.*]
check_untyped_defs = True
warn_return_any = True

